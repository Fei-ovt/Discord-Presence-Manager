<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discord 24/7 Presence</title>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #18191c;
      color: #dcddde;
      line-height: 1.6;
      padding: 0;
      margin: 0;
      max-width: 100%;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .header {
      padding: 15px 0;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .discord-icon {
      width: 24px;
      height: 24px;
      background-color: #5865f2;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .status-pill {
      width: 48px;
      height: 20px;
      background-color: #43b581;
      border-radius: 10px;
    }
    .card {
      background-color: #2f3136;
      border-radius: 8px;
      margin-bottom: 16px;
      overflow: hidden;
    }
    .card-header {
      padding: 14px 16px;
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .card-body {
      padding: 16px;
    }
    .user-profile {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }
    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #36393f;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      overflow: hidden;
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .user-info {
      display: flex;
      flex-direction: column;
    }
    .username {
      font-size: 14px;
      font-weight: 500;
    }
    .user-id {
      font-size: 12px;
      color: #b9bbbe;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .switch-with-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .switch-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #43b581;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #72767d;
      transition: .3s;
      border-radius: 34px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #5865f2;
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }
    .status-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .status-label {
      font-size: 13px;
      color: #b9bbbe;
    }
    .status-value {
      font-size: 13px;
      font-weight: 500;
    }
    .status-value.green {
      color: #43b581;
    }
    .status-value.red {
      color: #f04747;
    }
    .status-buttons {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin: 12px 0;
    }
    .status-button {
      flex: 1;
      border-radius: 4px;
      padding: 8px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #36393f;
      cursor: pointer;
      transition: background-color 0.2s;
      gap: 6px;
    }
    .status-button:hover {
      background-color: #40444b;
    }
    .status-button.active {
      background-color: #40444b;
    }
    .status-button span {
      font-size: 13px;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    .status-dot.online {
      background-color: #43b581;
    }
    .status-dot.idle {
      background-color: #faa61a;
    }
    .status-dot.dnd {
      background-color: #f04747;
    }
    .status-dot.invisible {
      background-color: #72767d;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-input-group {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .form-input {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      border: none;
      background-color: #36393f;
      color: #dcddde;
      font-size: 13px;
      box-sizing: border-box;
    }
    .form-input::placeholder {
      color: #72767d;
    }
    .form-input:focus {
      outline: none;
    }
    .form-button {
      background-color: #5865f2;
      border: none;
      border-radius: 4px;
      color: white;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 8px;
      cursor: pointer;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    .action-button {
      flex: 1;
      padding: 8px 0;
      border-radius: 4px;
      border: none;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .action-button.primary {
      background-color: #5865f2;
      color: white;
    }
    .action-button.primary:hover {
      background-color: #4752c4;
    }
    .action-button.secondary {
      background-color: #4f545c;
      color: white;
    }
    .action-button.secondary:hover {
      background-color: #5d6269;
    }
    .connection-progress {
      height: 3px;
      background-color: #4f545c;
      border-radius: 2px;
      overflow: hidden;
      margin: 8px 0;
    }
    .connection-progress-bar {
      height: 100%;
      background-color: #5865f2;
      width: 0%;
      transition: width 0.5s;
    }
    .log-panel {
      max-height: 120px;
      overflow-y: auto;
      background-color: #36393f;
      border-radius: 4px;
      padding: 10px;
      margin-top: 12px;
      font-family: monospace;
      font-size: 11px;
    }
    .log-entry {
      margin-bottom: 4px;
      line-height: 1.3;
    }
    .log-entry.status {
      color: #dcddde;
    }
    .log-entry.system {
      color: #7289da;
    }
    .log-type {
      display: inline-block;
      padding: 1px 4px;
      border-radius: 3px;
      color: #ffffff;
      font-weight: 500;
      margin-right: 4px;
    }
    .log-type.status {
      background-color: #43b581;
    }
    .log-type.system {
      background-color: #7289da;
    }
    .log-timestamp {
      color: #72767d;
      margin-right: 4px;
      font-size: 10px;
    }
    .token-display {
      background-color: #36393f;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      font-size: 11px;
      color: #72767d;
      margin: 8px 0;
      user-select: none;
    }
    .token-action {
      font-size: 12px;
      color: #7289da;
      display: flex;
      justify-content: flex-end;
      margin-top: 4px;
      cursor: pointer;
    }
    .footer {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 12px;
      color: #72767d;
    }
    
    .error-toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #f04747;
      color: white;
      padding: 10px 15px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1000;
      max-width: 90%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.3s, fadeOut 0.3s 4.7s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, 20px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; transform: translate(-50%, 0); }
      to { opacity: 0; transform: translate(-50%, 20px); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-title">
        <div class="discord-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
            <path d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09-.01-.02-.04-.03-.07-.03-1.5.26-2.93.71-4.27 1.33-.01 0-.02.01-.03.02-2.72 4.07-3.47 8.03-3.1 11.95 0 .02.01.04.03.05 1.8 1.32 3.53 2.12 5.24 2.65.03.01.06 0 .07-.02.4-.55.76-1.13 1.07-1.74.02-.04 0-.08-.04-.09-.57-.22-1.11-.48-1.64-.78-.04-.02-.04-.08-.01-.11.11-.08.22-.17.33-.25.02-.02.05-.02.07-.01 3.44 1.57 7.15 1.57 10.55 0 .02-.01.05-.01.07.01.11.09.22.17.33.26.04.03.04.09-.01.11-.52.31-1.07.56-1.64.78-.04.01-.05.06-.04.09.32.61.68 1.19 1.07 1.74.03.02.06.02.09.01 1.72-.53 3.45-1.33 5.25-2.65.02-.01.03-.03.03-.05.44-4.53-.73-8.46-3.1-11.95-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12 0-1.17.84-2.12 1.89-2.12 1.06 0 1.9.96 1.89 2.12 0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12 0-1.17.84-2.12 1.89-2.12 1.06 0 1.9.96 1.89 2.12 0 1.17-.83 2.12-1.89 2.12z"/>
          </svg>
        </div>
        Discord 24/7 Presence
      </div>
      <div class="status-pill"></div>
    </div>
    
    <div class="card">
      <div class="card-header">
        Account Status
        <div class="switch-with-indicator">
          <div class="switch-indicator"></div>
          <label class="switch">
            <input type="checkbox" id="toggle-account" checked>
            <span class="slider"></span>
          </label>
        </div>
      </div>
      <div class="card-body">
        <div class="user-profile">
          <div class="avatar">
            <img src="data:image/jpeg;base64,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" alt="User Avatar">
          </div>
          <div class="user-info">
            <div class="username">fel.ovt</div>
            <div class="user-id">#0</div>
          </div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Connection Status</div>
          <div id="connection-status" class="status-value green">Connected</div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Status Mode</div>
        </div>
        
        <div class="status-buttons">
          <div id="status-online" class="status-button active">
            <div class="status-dot online"></div>
            <span>Online</span>
          </div>
          <div id="status-idle" class="status-button">
            <div class="status-dot idle"></div>
            <span>Idle</span>
          </div>
          <div id="status-dnd" class="status-button">
            <div class="status-dot dnd"></div>
            <span>Do Not Disturb</span>
          </div>
          <div id="status-invisible" class="status-button">
            <div class="status-dot invisible"></div>
            <span>Invisible</span>
          </div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Active Since</div>
          <div id="active-since" class="status-value">6 seconds</div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Current Status</div>
          <div id="current-status" class="status-value green">Online</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        Voice Connection
        <label class="switch">
          <input type="checkbox" id="toggle-voice">
          <span class="slider"></span>
        </label>
      </div>
      <div class="card-body">
        <div class="form-group">
          <div class="status-label">Channel ID</div>
          <div class="form-input-group">
            <input type="text" id="channel-id" class="form-input" placeholder="Enter channel ID" required>
            <button id="save-channel" class="form-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </button>
          </div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Auto Reconnect</div>
          <label class="switch">
            <input type="checkbox" id="toggle-reconnect" checked>
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="action-buttons">
          <button id="connect-voice" class="action-button primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
              <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
            Connect
          </button>
          <button id="disconnect-voice" class="action-button secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"/>
            </svg>
            Disconnect
          </button>
        </div>
        
        <div class="status-row">
          <div class="status-label">Connection Status:</div>
        </div>
        <div class="connection-progress">
          <div id="connection-progress-bar" class="connection-progress-bar"></div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Connected to:</div>
          <div id="connected-to" class="status-value">Not connected</div>
        </div>
        
        <div class="status-row">
          <div class="status-label">Connected for:</div>
          <div id="connected-for" class="status-value">N/A</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        Settings & Logs
      </div>
      <div class="card-body">
        <div class="status-row">
          <div class="status-label">Discord Token</div>
          <div class="token-action">Set via env</div>
        </div>
        <div class="token-display">
          DISCORD_TOKEN = SETTING IN ENV
        </div>
        
        <div class="status-row">
          <div class="status-label">System Notifications</div>
          <label class="switch">
            <input type="checkbox" id="toggle-notifications" checked>
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="status-row">
          <div class="status-label">Auto-start on System Boot</div>
          <label class="switch">
            <input type="checkbox" id="toggle-autostart">
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="status-label">Activity Log</div>
        <div id="log-panel" class="log-panel">
          <div class="log-entry">
            <span class="log-type status">[Status]</span>
            <span class="log-timestamp">2025-04-29 13:31:30</span>
            Status successfully changed to online
          </div>
          <div class="log-entry">
            <span class="log-type system">[System]</span>
            <span class="log-timestamp">2025-04-29 13:31:28</span>
            Changing status to online
          </div>
          <div class="log-entry">
            <span class="log-type system">[System]</span>
            <span class="log-timestamp">2025-04-29 13:31:28</span>
            Connected to Discord as fel.ovt
          </div>
          <div class="log-entry">
            <span class="log-type system">[System]</span>
            <span class="log-timestamp">2025-04-29 13:31:25</span>
            Application started
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      <div>Uptime: <span id="uptime">16 seconds</span></div>
      <div>Discord 24/7 Presence</div>
    </div>
  </div>

  <script>
    // Status variables
    const state = {
      connectionStatus: 'connected',
      statusMode: 'online',
      isAccountActive: true,
      isVoiceActive: false,
      voiceStatus: 'disconnected',
      autoReconnect: true,
      systemNotifications: true,
      autoStart: false
    };
    
    // UI elements
    const globalStatusPill = document.querySelector('.status-pill');
    const connectionStatusEl = document.getElementById('connection-status');
    const currentStatusEl = document.getElementById('current-status');
    const activesinceEl = document.getElementById('active-since');
    const connectedToEl = document.getElementById('connected-to');
    const connectedForEl = document.getElementById('connected-for');
    const connectionProgressBar = document.getElementById('connection-progress-bar');
    const uptimeEl = document.getElementById('uptime');
    const logPanel = document.getElementById('log-panel');
    
    // Toggles
    const toggleAccountInput = document.getElementById('toggle-account');
    const toggleVoiceInput = document.getElementById('toggle-voice');
    const toggleReconnectInput = document.getElementById('toggle-reconnect');
    const toggleNotificationsInput = document.getElementById('toggle-notifications');
    const toggleAutostartInput = document.getElementById('toggle-autostart');
    
    // Status buttons
    const statusOnlineBtn = document.getElementById('status-online');
    const statusIdleBtn = document.getElementById('status-idle');
    const statusDndBtn = document.getElementById('status-dnd');
    const statusInvisibleBtn = document.getElementById('status-invisible');
    
    // Voice connection
    const channelIdInput = document.getElementById('channel-id');
    const saveChannelBtn = document.getElementById('save-channel');
    const connectVoiceBtn = document.getElementById('connect-voice');
    const disconnectVoiceBtn = document.getElementById('disconnect-voice');
    
    // Function to update the UI based on status
    function updateUI() {
      // Update connection indicator
      connectionStatusEl.textContent = state.connectionStatus.charAt(0).toUpperCase() + state.connectionStatus.slice(1);
      connectionStatusEl.className = `status-value ${state.connectionStatus === 'connected' ? 'green' : 'red'}`;
      
      // Update current status
      currentStatusEl.textContent = state.statusMode.charAt(0).toUpperCase() + state.statusMode.slice(1);
      
      if (state.statusMode === 'online') {
        currentStatusEl.className = 'status-value green';
      } else if (state.statusMode === 'idle') {
        currentStatusEl.className = 'status-value';
        currentStatusEl.style.color = '#faa61a';
      } else if (state.statusMode === 'dnd') {
        currentStatusEl.className = 'status-value red';
      } else {
        currentStatusEl.className = 'status-value';
        currentStatusEl.style.color = '#72767d';
      }
      
      // Update global status pill
      if (!state.isAccountActive) {
        globalStatusPill.style.backgroundColor = '#72767d';
      } else if (state.statusMode === 'online') {
        globalStatusPill.style.backgroundColor = '#43b581';
      } else if (state.statusMode === 'idle') {
        globalStatusPill.style.backgroundColor = '#faa61a';
      } else if (state.statusMode === 'dnd') {
        globalStatusPill.style.backgroundColor = '#f04747';
      } else {
        globalStatusPill.style.backgroundColor = '#72767d';
      }
      
      // Update voice connection UI
      toggleVoiceInput.checked = state.isVoiceActive;
      
      if (state.voiceStatus === 'connected') {
        connectionProgressBar.style.width = '100%';
        connectedToEl.textContent = 'Voice Channel';
      } else {
        connectionProgressBar.style.width = '0%';
        connectedToEl.textContent = 'Not connected';
        connectedForEl.textContent = 'N/A';
      }
      
      // Update status buttons
      statusOnlineBtn.className = `status-button ${state.statusMode === 'online' ? 'active' : ''}`;
      statusIdleBtn.className = `status-button ${state.statusMode === 'idle' ? 'active' : ''}`;
      statusDndBtn.className = `status-button ${state.statusMode === 'dnd' ? 'active' : ''}`;
      statusInvisibleBtn.className = `status-button ${state.statusMode === 'invisible' ? 'active' : ''}`;
      
      // Update toggle states
      toggleAccountInput.checked = state.isAccountActive;
      toggleReconnectInput.checked = state.autoReconnect;
      toggleNotificationsInput.checked = state.systemNotifications;
      toggleAutostartInput.checked = state.autoStart;
    }
    
    // Function to show an error toast message
    function showErrorToast(message) {
      // Remove any existing toast
      const existing = document.querySelector('.error-toast');
      if (existing) {
        existing.remove();
      }
      
      // Create new toast
      const toast = document.createElement('div');
      toast.className = 'error-toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      // Remove after 5 seconds
      setTimeout(() => {
        toast.remove();
      }, 5000);
    }
    
    // Function to add a log entry
    function addLogEntry(message, type = 'system') {
      const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      
      const typeSpan = document.createElement('span');
      typeSpan.className = `log-type ${type}`;
      typeSpan.textContent = type === 'system' ? '[System]' : '[Status]';
      
      const timestampSpan = document.createElement('span');
      timestampSpan.className = 'log-timestamp';
      timestampSpan.textContent = timestamp;
      
      entry.appendChild(typeSpan);
      entry.appendChild(document.createTextNode(' '));
      entry.appendChild(timestampSpan);
      entry.appendChild(document.createTextNode(' ' + message));
      
      // Insert at the top (most recent first)
      if (logPanel.firstChild) {
        logPanel.insertBefore(entry, logPanel.firstChild);
      } else {
        logPanel.appendChild(entry);
      }
      
      // If this is an error message, also show a toast
      if (type === 'error') {
        showErrorToast(message);
      }
    }
    
    // Set up WebSocket connection
    function setupWebSocket() {
      addLogEntry('Attempting to connect to server...', 'system');
      
      try {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/ws`;
        const socket = new WebSocket(wsUrl);
        
        socket.onopen = () => {
          state.connectionStatus = 'connected';
          addLogEntry('Connected to server!', 'status');
          updateUI();
        };
        
        socket.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            
            // Update our status variables
            if (data.connectionStatus) state.connectionStatus = data.connectionStatus;
            if (data.statusMode) state.statusMode = data.statusMode;
            if (data.isAccountActive !== undefined) state.isAccountActive = data.isAccountActive;
            if (data.isVoiceActive !== undefined) state.isVoiceActive = data.isVoiceActive;
            if (data.voiceStatus) state.voiceStatus = data.voiceStatus;
            if (data.autoReconnect !== undefined) state.autoReconnect = data.autoReconnect;
            
            // Update active since
            if (data.activeSince) {
              activesinceEl.textContent = data.activeSince;
            }
            
            // Update uptime
            if (data.uptime) {
              uptimeEl.textContent = data.uptime;
            }
            
            // Update voice connection details
            if (data.connectedChannel) {
              connectedToEl.textContent = data.connectedChannel;
            }
            
            if (data.connectionDuration) {
              connectedForEl.textContent = data.connectionDuration;
            }
            
            updateUI();
          } catch (error) {
            console.error('Error parsing message:', error);
          }
        };
        
        socket.onclose = () => {
          state.connectionStatus = 'disconnected';
          addLogEntry('Disconnected from server. Reconnecting...', 'error');
          updateUI();
          
          // Try to reconnect after 3 seconds
          setTimeout(setupWebSocket, 3000);
        };
        
        socket.onerror = (error) => {
          state.connectionStatus = 'error';
          addLogEntry('WebSocket error!', 'error');
          console.error('WebSocket error:', error);
          updateUI();
        };
      } catch (error) {
        addLogEntry('Error setting up WebSocket connection!', 'error');
        console.error('Setup error:', error);
      }
    }
    
    // Set up API request function with better error handling
    async function makeRequest(endpoint, method = 'GET', data = null) {
      try {
        // Disable buttons during request to prevent multiple clicks
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          button.disabled = true;
          button.style.opacity = '0.7';
        });
        
        const options = {
          method,
          headers: {
            'Content-Type': 'application/json'
          }
        };
        
        if (data) {
          options.body = JSON.stringify(data);
        }
        
        const response = await fetch(endpoint, options);
        
        // Re-enable buttons
        buttons.forEach(button => {
          button.disabled = false;
          button.style.opacity = '1';
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        return await response.json();
      } catch (error) {
        // Re-enable buttons on error too
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          button.disabled = false;
          button.style.opacity = '1';
        });
        
        addLogEntry(`API request failed: ${error.message}`, 'error');
        console.error('API request error:', error);
        throw error;
      }
    }
    
    // Toggle account status
    toggleAccountInput.addEventListener('change', async () => {
      try {
        const newValue = toggleAccountInput.checked;
        addLogEntry(`Setting account ${newValue ? 'active' : 'inactive'}...`);
        await makeRequest('/api/discord/account-status', 'POST', { isActive: newValue });
        state.isAccountActive = newValue;
        addLogEntry(`Account is now ${newValue ? 'active' : 'inactive'}`, 'status');
        updateUI();
      } catch (error) {
        toggleAccountInput.checked = state.isAccountActive; // Revert to original state on error
        addLogEntry('Failed to toggle account status', 'error');
      }
    });
    
    // Status mode buttons with debounce to prevent rapid clicks
    let statusButtonClickTimeout = null;
    
    function handleStatusButtonClick(mode) {
      if (statusButtonClickTimeout) {
        return; // Prevent rapid clicking
      }
      
      statusButtonClickTimeout = setTimeout(() => {
        statusButtonClickTimeout = null;
      }, 1000); // 1 second debounce
      
      // Immediately update UI for responsiveness
      const oldMode = state.statusMode;
      state.statusMode = mode;
      updateUI();
      
      makeRequest('/api/discord/status-mode', 'POST', { mode })
        .then(() => {
          addLogEntry(`Status set to ${mode}`, 'status');
        })
        .catch((error) => {
          // Revert on error
          state.statusMode = oldMode;
          updateUI();
          addLogEntry(`Failed to set status to ${mode}`, 'error');
        });
    }
    
    statusOnlineBtn.addEventListener('click', () => handleStatusButtonClick('online'));
    statusIdleBtn.addEventListener('click', () => handleStatusButtonClick('idle'));
    statusDndBtn.addEventListener('click', () => handleStatusButtonClick('dnd'));
    statusInvisibleBtn.addEventListener('click', () => handleStatusButtonClick('invisible'));
    
    // Voice connection
    toggleVoiceInput.addEventListener('change', async () => {
      try {
        const newValue = toggleVoiceInput.checked;
        addLogEntry(`Setting voice ${newValue ? 'active' : 'inactive'}...`);
        await makeRequest('/api/discord/voice-active', 'POST', { isActive: newValue });
        state.isVoiceActive = newValue;
        addLogEntry(`Voice is now ${newValue ? 'active' : 'inactive'}`, 'status');
        updateUI();
      } catch (error) {
        toggleVoiceInput.checked = state.isVoiceActive; // Revert to original state on error
        addLogEntry('Failed to toggle voice status', 'error');
      }
    });
    
    // Save channel ID with validation
    saveChannelBtn.addEventListener('click', async () => {
      try {
        const channelId = channelIdInput.value.trim();
        
        if (!channelId) {
          addLogEntry('Please enter a channel ID', 'error');
          return;
        }
        
        // Basic validation - Discord channel IDs are typically 18+ digits
        if (!/^\d{17,}$/.test(channelId)) {
          addLogEntry('Invalid channel ID format. Discord IDs are long numbers.', 'error');
          return;
        }
        
        addLogEntry(`Setting voice channel ID to ${channelId}...`);
        await makeRequest('/api/discord/channel-id', 'POST', { channelId });
        addLogEntry(`Channel ID set to ${channelId}`, 'status');
      } catch (error) {
        addLogEntry('Failed to set channel ID', 'error');
      }
    });
    
    // Connect to voice channel with better error handling
    connectVoiceBtn.addEventListener('click', async () => {
      try {
        const channelId = channelIdInput.value.trim();
        
        if (!channelId) {
          addLogEntry('Please enter a voice channel ID', 'error');
          return;
        }
        
        // Basic validation - Discord channel IDs are typically 18+ digits
        if (!/^\d{17,}$/.test(channelId)) {
          addLogEntry('Invalid channel ID format. Discord IDs are long numbers.', 'error');
          return;
        }
        
        // Disable buttons during connection to prevent multiple clicks
        connectVoiceBtn.disabled = true;
        connectVoiceBtn.textContent = 'Connecting...';
        
        // First save the channel ID
        addLogEntry(`Setting voice channel ID to ${channelId}...`);
        await makeRequest('/api/discord/channel-id', 'POST', { channelId });
        
        // Then connect to the voice channel
        addLogEntry('Connecting to voice channel...');
        try {
          await makeRequest('/api/discord/connect-voice', 'POST');
          state.voiceStatus = 'connected';
          addLogEntry('Connected to voice channel', 'status');
        } catch (error) {
          throw new Error(`Failed to connect: ${error.message}`);
        }
        
        updateUI();
      } catch (error) {
        addLogEntry(`Failed to connect to voice channel: ${error.message}`, 'error');
      } finally {
        // Always re-enable button and restore text
        connectVoiceBtn.disabled = false;
        connectVoiceBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg> Connect';
      }
    });
    
    // Disconnect from voice channel with better error handling
    disconnectVoiceBtn.addEventListener('click', async () => {
      try {
        // Disable button during disconnection
        disconnectVoiceBtn.disabled = true;
        disconnectVoiceBtn.textContent = 'Disconnecting...';
        
        addLogEntry('Disconnecting from voice channel...');
        await makeRequest('/api/discord/disconnect-voice', 'POST');
        state.voiceStatus = 'disconnected';
        addLogEntry('Disconnected from voice channel', 'status');
        updateUI();
      } catch (error) {
        addLogEntry('Failed to disconnect from voice channel', 'error');
      } finally {
        // Always re-enable button and restore text
        disconnectVoiceBtn.disabled = false;
        disconnectVoiceBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28zm-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.98 5.99zM4.27 3L3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73 4.27 3z"/></svg> Disconnect';
      }
    });
    
    // Settings toggles
    toggleReconnectInput.addEventListener('change', async () => {
      try {
        const newValue = toggleReconnectInput.checked;
        addLogEntry(`Setting auto reconnect ${newValue ? 'enabled' : 'disabled'}...`);
        await makeRequest('/api/discord/auto-reconnect', 'POST', { enabled: newValue });
        state.autoReconnect = newValue;
        addLogEntry(`Auto reconnect is now ${newValue ? 'enabled' : 'disabled'}`, 'status');
        updateUI();
      } catch (error) {
        toggleReconnectInput.checked = state.autoReconnect; // Revert to original state on error
        addLogEntry('Failed to toggle auto reconnect', 'error');
      }
    });
    
    toggleNotificationsInput.addEventListener('change', async () => {
      try {
        const newValue = toggleNotificationsInput.checked;
        addLogEntry(`Setting system notifications ${newValue ? 'enabled' : 'disabled'}...`);
        await makeRequest('/api/discord/notifications', 'POST', { enabled: newValue });
        state.systemNotifications = newValue;
        addLogEntry(`System notifications are now ${newValue ? 'enabled' : 'disabled'}`, 'status');
        updateUI();
      } catch (error) {
        toggleNotificationsInput.checked = state.systemNotifications; // Revert to original state on error
        addLogEntry('Failed to toggle system notifications', 'error');
      }
    });
    
    // Initial setup
    async function initializeApp() {
      try {
        // Get initial status
        const status = await makeRequest('/api/discord/status');
        
        if (status && status.status) {
          if (status.status.connectionStatus) state.connectionStatus = status.status.connectionStatus;
          if (status.status.statusMode) state.statusMode = status.status.statusMode;
          if (status.status.isAccountActive !== undefined) state.isAccountActive = status.status.isAccountActive;
          if (status.status.isVoiceActive !== undefined) state.isVoiceActive = status.status.isVoiceActive;
          if (status.status.voiceStatus) state.voiceStatus = status.status.voiceStatus;
          if (status.status.autoReconnect !== undefined) state.autoReconnect = status.status.autoReconnect;
          
          if (status.status.activeSince) {
            activesinceEl.textContent = status.status.activeSince;
          }
          
          if (status.status.uptime) {
            uptimeEl.textContent = status.status.uptime;
          }
          
          if (status.status.connectedChannel) {
            connectedToEl.textContent = status.status.connectedChannel;
          }
          
          if (status.status.connectionDuration) {
            connectedForEl.textContent = status.status.connectionDuration;
          }
          
          if (status.channelId) {
            channelIdInput.value = status.channelId;
          }
        }
        
        updateUI();
        addLogEntry('Connected to Discord as fel.ovt', 'system');
      } catch (error) {
        addLogEntry('Failed to get initial status. Check your Discord token.', 'error');
        console.error('Initialization error:', error);
      }
      
      // Set up WebSocket
      setupWebSocket();
    }
    
    // Add touch feedback to buttons for mobile
    const allButtons = document.querySelectorAll('button');
    allButtons.forEach(button => {
      button.addEventListener('touchstart', function() {
        this.style.transform = 'scale(0.95)';
      });
      button.addEventListener('touchend', function() {
        this.style.transform = 'scale(1)';
      });
    });
    
    // Start the app
    initializeApp();
    
    // Set up periodic uptime updates (if WebSocket fails)
    setInterval(async () => {
      try {
        if (state.connectionStatus !== 'connected') {
          const response = await fetch('/api/health');
          const data = await response.json();
          
          if (data && data.uptime) {
            uptimeEl.textContent = `${Math.floor(data.uptime)} seconds`;
          }
        }
      } catch (error) {
        console.error('Error updating uptime:', error);
      }
    }, 30000);
  </script>
</body>
</html>

  <script>
    // Status variables
    const state = {
      connectionStatus: 'connected',
      statusMode: 'online',
      isAccountActive: true,
      isVoiceActive: false,
      voiceStatus: 'disconnected',
      autoReconnect: true,
      systemNotifications: true,
      autoStart: false
    };
    
    // UI elements
    const globalStatusPill = document.getElementById('global-status-pill');
    const connectionStatusEl = document.getElementById('connection-status');
    const currentStatusEl = document.getElementById('current-status');
    const currentStatus2El = document.getElementById('current-status-2');
    const activesinceEl = document.getElementById('active-since');
    const connectedToEl = document.getElementById('connected-to');
    const connectedForEl = document.getElementById('connected-for');
    const connectionProgressBar = document.getElementById('connection-progress-bar');
    const uptimeEl = document.getElementById('uptime');
    const logPanel = document.getElementById('log-panel');
    
    // Toggles
    const toggleAccountInput = document.getElementById('toggle-account');
    const toggleVoiceInput = document.getElementById('toggle-voice');
    const toggleReconnectInput = document.getElementById('toggle-reconnect');
    const toggleNotificationsInput = document.getElementById('toggle-notifications');
    const toggleAutostartInput = document.getElementById('toggle-autostart');
    
    // Status buttons
    const statusOnlineBtn = document.getElementById('status-online');
    const statusIdleBtn = document.getElementById('status-idle');
    const statusDndBtn = document.getElementById('status-dnd');
    const statusInvisibleBtn = document.getElementById('status-invisible');
    
    // Voice connection
    const channelIdInput = document.getElementById('channel-id');
    const saveChannelBtn = document.getElementById('save-channel');
    const connectVoiceBtn = document.getElementById('connect-voice');
    const disconnectVoiceBtn = document.getElementById('disconnect-voice');
    
    // Function to update the UI based on status
    function updateUI() {
      // Update connection indicator
      connectionStatusEl.textContent = state.connectionStatus.charAt(0).toUpperCase() + state.connectionStatus.slice(1);
      connectionStatusEl.className = `status-value ${state.connectionStatus === 'connected' ? 'green' : 'red'}`;
      
      // Update current status
      currentStatusEl.textContent = state.statusMode.charAt(0).toUpperCase() + state.statusMode.slice(1);
      currentStatus2El.textContent = state.statusMode.charAt(0).toUpperCase() + state.statusMode.slice(1);
      
      if (state.statusMode === 'online') {
        currentStatusEl.className = 'status-value green';
        currentStatus2El.className = 'status-value green';
      } else if (state.statusMode === 'idle') {
        currentStatusEl.className = 'status-value';
        currentStatusEl.style.color = '#faa61a';
        currentStatus2El.className = 'status-value';
        currentStatus2El.style.color = '#faa61a';
      } else if (state.statusMode === 'dnd') {
        currentStatusEl.className = 'status-value red';
        currentStatus2El.className = 'status-value red';
      } else {
        currentStatusEl.className = 'status-value';
        currentStatusEl.style.color = '#72767d';
        currentStatus2El.className = 'status-value';
        currentStatus2El.style.color = '#72767d';
      }
      
      // Update global status pill
      if (!state.isAccountActive) {
        globalStatusPill.style.backgroundColor = '#72767d';
      } else if (state.statusMode === 'online') {
        globalStatusPill.style.backgroundColor = '#43b581';
      } else if (state.statusMode === 'idle') {
        globalStatusPill.style.backgroundColor = '#faa61a';
      } else if (state.statusMode === 'dnd') {
        globalStatusPill.style.backgroundColor = '#f04747';
      } else {
        globalStatusPill.style.backgroundColor = '#72767d';
      }
      
      // Update voice connection UI
      toggleVoiceInput.checked = state.isVoiceActive;
      
      if (state.voiceStatus === 'connected') {
        connectionProgressBar.style.width = '100%';
        connectedToEl.textContent = 'Voice Channel';
      } else {
        connectionProgressBar.style.width = '0%';
        connectedToEl.textContent = 'Not connected';
        connectedForEl.textContent = 'N/A';
      }
      
      // Update status buttons
      statusOnlineBtn.className = `status-button ${state.statusMode === 'online' ? 'active' : ''}`;
      statusIdleBtn.className = `status-button ${state.statusMode === 'idle' ? 'active' : ''}`;
      statusDndBtn.className = `status-button ${state.statusMode === 'dnd' ? 'active' : ''}`;
      statusInvisibleBtn.className = `status-button ${state.statusMode === 'invisible' ? 'active' : ''}`;
      
      // Update toggle states
      toggleAccountInput.checked = state.isAccountActive;
      toggleReconnectInput.checked = state.autoReconnect;
      toggleNotificationsInput.checked = state.systemNotifications;
      toggleAutostartInput.checked = state.autoStart;
    }
    
    // Function to show an error toast message
    function showErrorToast(message) {
      // Remove any existing toast
      const existing = document.querySelector('.error-toast');
      if (existing) {
        existing.remove();
      }
      
      // Create new toast
      const toast = document.createElement('div');
      toast.className = 'error-toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      // Remove after 5 seconds
      setTimeout(() => {
        toast.remove();
      }, 5000);
    }
    
    // Function to add a log entry
    function addLogEntry(message, type = 'system') {
      const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      
      const timestampSpan = document.createElement('span');
      timestampSpan.className = 'timestamp';
      timestampSpan.textContent = timestamp;
      
      entry.appendChild(timestampSpan);
      entry.append(` ${message}`);
      
      // Insert at the top (most recent first)
      if (logPanel.firstChild) {
        logPanel.insertBefore(entry, logPanel.firstChild);
      } else {
        logPanel.appendChild(entry);
      }
      
      // If this is an error message, also show a toast
      if (type === 'error') {
        showErrorToast(message);
      }
    }
    
    // Set up WebSocket connection
    function setupWebSocket() {
      addLogEntry('Attempting to connect to server...', 'system');
      
      try {
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/ws`;
        const socket = new WebSocket(wsUrl);
        
        socket.onopen = () => {
          state.connectionStatus = 'connected';
          addLogEntry('Connected to server!', 'status');
          updateUI();
        };
        
        socket.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            
            // Update our status variables
            if (data.connectionStatus) state.connectionStatus = data.connectionStatus;
            if (data.statusMode) state.statusMode = data.statusMode;
            if (data.isAccountActive !== undefined) state.isAccountActive = data.isAccountActive;
            if (data.isVoiceActive !== undefined) state.isVoiceActive = data.isVoiceActive;
            if (data.voiceStatus) state.voiceStatus = data.voiceStatus;
            if (data.autoReconnect !== undefined) state.autoReconnect = data.autoReconnect;
            
            // Update active since
            if (data.activeSince) {
              activesinceEl.textContent = data.activeSince;
            }
            
            // Update uptime
            if (data.uptime) {
              uptimeEl.textContent = data.uptime;
            }
            
            // Update voice connection details
            if (data.connectedChannel) {
              connectedToEl.textContent = data.connectedChannel;
            }
            
            if (data.connectionDuration) {
              connectedForEl.textContent = data.connectionDuration;
            }
            
            updateUI();
          } catch (error) {
            console.error('Error parsing message:', error);
          }
        };
        
        socket.onclose = () => {
          state.connectionStatus = 'disconnected';
          addLogEntry('Disconnected from server. Reconnecting...', 'error');
          updateUI();
          
          // Try to reconnect after 3 seconds
          setTimeout(setupWebSocket, 3000);
        };
        
        socket.onerror = (error) => {
          state.connectionStatus = 'error';
          addLogEntry('WebSocket error!', 'error');
          console.error('WebSocket error:', error);
          updateUI();
        };
      } catch (error) {
        addLogEntry('Error setting up WebSocket connection!', 'error');
        console.error('Setup error:', error);
      }
    }
    
    // Set up API request function with better error handling
    async function makeRequest(endpoint, method = 'GET', data = null) {
      try {
        // Disable buttons during request to prevent multiple clicks
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          button.disabled = true;
          button.style.opacity = '0.7';
        });
        
        const options = {
          method,
          headers: {
            'Content-Type': 'application/json'
          }
        };
        
        if (data) {
          options.body = JSON.stringify(data);
        }
        
        const response = await fetch(endpoint, options);
        
        // Re-enable buttons
        buttons.forEach(button => {
          button.disabled = false;
          button.style.opacity = '1';
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        return await response.json();
      } catch (error) {
        // Re-enable buttons on error too
        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
          button.disabled = false;
          button.style.opacity = '1';
        });
        
        addLogEntry(`API request failed: ${error.message}`, 'error');
        console.error('API request error:', error);
        throw error;
      }
    }
    
    // Toggle account status
    toggleAccountInput.addEventListener('change', async () => {
      try {
        const newValue = toggleAccountInput.checked;
        addLogEntry(`Setting account ${newValue ? 'active' : 'inactive'}...`);
        await makeRequest('/api/discord/account-status', 'POST', { isActive: newValue });
        state.isAccountActive = newValue;
        addLogEntry(`Account is now ${newValue ? 'active' : 'inactive'}`, 'status');
        updateUI();
      } catch (error) {
        toggleAccountInput.checked = state.isAccountActive; // Revert to original state on error
        addLogEntry('Failed to toggle account status', 'error');
      }
    });
    
    // Status mode buttons with debounce to prevent rapid clicks
    let statusButtonClickTimeout = null;
    
    function handleStatusButtonClick(mode) {
      if (statusButtonClickTimeout) {
        return; // Prevent rapid clicking
      }
      
      statusButtonClickTimeout = setTimeout(() => {
        statusButtonClickTimeout = null;
      }, 1000); // 1 second debounce
      
      // Immediately update UI for responsiveness
      const oldMode = state.statusMode;
      state.statusMode = mode;
      updateUI();
      
      makeRequest('/api/discord/status-mode', 'POST', { mode })
        .then(() => {
          addLogEntry(`Status set to ${mode}`, 'status');
        })
        .catch((error) => {
          // Revert on error
          state.statusMode = oldMode;
          updateUI();
          addLogEntry(`Failed to set status to ${mode}`, 'error');
        });
    }
    
    statusOnlineBtn.addEventListener('click', () => handleStatusButtonClick('online'));
    statusIdleBtn.addEventListener('click', () => handleStatusButtonClick('idle'));
    statusDndBtn.addEventListener('click', () => handleStatusButtonClick('dnd'));
    statusInvisibleBtn.addEventListener('click', () => handleStatusButtonClick('invisible'));
    
    // Voice connection
    toggleVoiceInput.addEventListener('change', async () => {
      try {
        const newValue = toggleVoiceInput.checked;
        addLogEntry(`Setting voice ${newValue ? 'active' : 'inactive'}...`);
        await makeRequest('/api/discord/voice-active', 'POST', { isActive: newValue });
        state.isVoiceActive = newValue;
        addLogEntry(`Voice is now ${newValue ? 'active' : 'inactive'}`, 'status');
        updateUI();
      } catch (error) {
        toggleVoiceInput.checked = state.isVoiceActive; // Revert to original state on error
        addLogEntry('Failed to toggle voice status', 'error');
      }
    });
    
    // Save channel ID with validation
    saveChannelBtn.addEventListener('click', async () => {
      try {
        const channelId = channelIdInput.value.trim();
        
        if (!channelId) {
          addLogEntry('Please enter a channel ID', 'error');
          return;
        }
        
        // Basic validation - Discord channel IDs are typically 18+ digits
        if (!/^\d{17,}$/.test(channelId)) {
          addLogEntry('Invalid channel ID format. Discord IDs are long numbers.', 'error');
          return;
        }
        
        addLogEntry(`Setting voice channel ID to ${channelId}...`);
        await makeRequest('/api/discord/channel-id', 'POST', { channelId });
        addLogEntry(`Channel ID set to ${channelId}`, 'status');
      } catch (error) {
        addLogEntry('Failed to set channel ID', 'error');
      }
    });
    
    // Connect to voice channel with better error handling
    connectVoiceBtn.addEventListener('click', async () => {
      try {
        const channelId = channelIdInput.value.trim();
        
        if (!channelId) {
          addLogEntry('Please enter a voice channel ID', 'error');
          return;
        }
        
        // Basic validation - Discord channel IDs are typically 18+ digits
        if (!/^\d{17,}$/.test(channelId)) {
          addLogEntry('Invalid channel ID format. Discord IDs are long numbers.', 'error');
          return;
        }
        
        // Disable buttons during connection to prevent multiple clicks
        connectVoiceBtn.disabled = true;
        connectVoiceBtn.textContent = 'Connecting...';
        
        // First save the channel ID
        addLogEntry(`Setting voice channel ID to ${channelId}...`);
        await makeRequest('/api/discord/channel-id', 'POST', { channelId });
        
        // Then connect to the voice channel
        addLogEntry('Connecting to voice channel...');
        try {
          await makeRequest('/api/discord/connect-voice', 'POST');
          state.voiceStatus = 'connected';
          addLogEntry('Connected to voice channel', 'status');
        } catch (error) {
          throw new Error(`Failed to connect: ${error.message}`);
        }
        
        updateUI();
      } catch (error) {
        addLogEntry(`Failed to connect to voice channel: ${error.message}`, 'error');
      } finally {
        // Always re-enable button and restore text
        connectVoiceBtn.disabled = false;
        connectVoiceBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 2C9.10457 2 10 2.89543 10 4V8C10 9.10457 9.10457 10 8 10C6.89543 10 6 9.10457 6 8V4C6 2.89543 6.89543 2 8 2Z" fill="white"/><path d="M3 7V8C3 10.7614 5.23858 13 8 13C10.7614 13 13 10.7614 13 8V7H14V8C14 11.1826 11.433 13.753 8.25 13.9847V16H7.75V13.9847C4.56702 13.753 2 11.1826 2 8V7H3Z" fill="white"/></svg> Connect';
      }
    });
    
    // Disconnect from voice channel with better error handling
    disconnectVoiceBtn.addEventListener('click', async () => {
      try {
        // Disable button during disconnection
        disconnectVoiceBtn.disabled = true;
        disconnectVoiceBtn.textContent = 'Disconnecting...';
        
        addLogEntry('Disconnecting from voice channel...');
        await makeRequest('/api/discord/disconnect-voice', 'POST');
        state.voiceStatus = 'disconnected';
        addLogEntry('Disconnected from voice channel', 'status');
        updateUI();
      } catch (error) {
        addLogEntry('Failed to disconnect from voice channel', 'error');
      } finally {
        // Always re-enable button and restore text
        disconnectVoiceBtn.disabled = false;
        disconnectVoiceBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.25 1.25L14.75 14.75" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M6.35 6.4C6.12 6.86 6 7.4 6 8V8C6 9.1 6.9 10 8 10C8.6 10 9.14 9.75 9.54 9.35" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M11 8C11 7.4 10.8 6.86 10.5 6.4L8 4C8.56 4 9.06 4.22 9.46 4.54" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M13 8V7H14V8C14 11.18 11.43 13.75 8.25 13.98V16H7.75V13.98C7.39 13.95 7.05 13.88 6.72 13.78" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.2 11.28C3.48 10.5 3 9.32 3 8V7H2V8C2 10.05 3.23 11.81 5 12.65" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg> Disconnect';
      }
    });
    
    // Settings toggles
    toggleReconnectInput.addEventListener('change', async () => {
      try {
        const newValue = toggleReconnectInput.checked;
        addLogEntry(`Setting auto reconnect ${newValue ? 'enabled' : 'disabled'}...`);
        await makeRequest('/api/discord/auto-reconnect', 'POST', { enabled: newValue });
        state.autoReconnect = newValue;
        addLogEntry(`Auto reconnect is now ${newValue ? 'enabled' : 'disabled'}`, 'status');
        updateUI();
      } catch (error) {
        toggleReconnectInput.checked = state.autoReconnect; // Revert to original state on error
        addLogEntry('Failed to toggle auto reconnect', 'error');
      }
    });
    
    toggleNotificationsInput.addEventListener('change', async () => {
      try {
        const newValue = toggleNotificationsInput.checked;
        addLogEntry(`Setting system notifications ${newValue ? 'enabled' : 'disabled'}...`);
        await makeRequest('/api/discord/notifications', 'POST', { enabled: newValue });
        state.systemNotifications = newValue;
        addLogEntry(`System notifications are now ${newValue ? 'enabled' : 'disabled'}`, 'status');
        updateUI();
      } catch (error) {
        toggleNotificationsInput.checked = state.systemNotifications; // Revert to original state on error
        addLogEntry('Failed to toggle system notifications', 'error');
      }
    });
    
    // Initial setup
    async function initializeApp() {
      try {
        // Get initial status
        const status = await makeRequest('/api/discord/status');
        
        if (status && status.status) {
          if (status.status.connectionStatus) state.connectionStatus = status.status.connectionStatus;
          if (status.status.statusMode) state.statusMode = status.status.statusMode;
          if (status.status.isAccountActive !== undefined) state.isAccountActive = status.status.isAccountActive;
          if (status.status.isVoiceActive !== undefined) state.isVoiceActive = status.status.isVoiceActive;
          if (status.status.voiceStatus) state.voiceStatus = status.status.voiceStatus;
          if (status.status.autoReconnect !== undefined) state.autoReconnect = status.status.autoReconnect;
          
          if (status.status.activeSince) {
            activesinceEl.textContent = status.status.activeSince;
          }
          
          if (status.status.uptime) {
            uptimeEl.textContent = status.status.uptime;
          }
          
          if (status.status.connectedChannel) {
            connectedToEl.textContent = status.status.connectedChannel;
          }
          
          if (status.status.connectionDuration) {
            connectedForEl.textContent = status.status.connectionDuration;
          }
          
          if (status.channelId) {
            channelIdInput.value = status.channelId;
          }
        }
        
        updateUI();
        addLogEntry('Successfully initialized from server status', 'status');
      } catch (error) {
        addLogEntry('Failed to get initial status. Check your Discord token.', 'error');
        console.error('Initialization error:', error);
      }
      
      // Set up WebSocket
      setupWebSocket();
    }
    
    // Add touch feedback to buttons for mobile
    const allButtons = document.querySelectorAll('button');
    allButtons.forEach(button => {
      button.addEventListener('touchstart', function() {
        this.style.transform = 'scale(0.95)';
      });
      button.addEventListener('touchend', function() {
        this.style.transform = 'scale(1)';
      });
    });
    
    // Start the app
    initializeApp();
    
    // Set up periodic uptime updates (if WebSocket fails)
    setInterval(async () => {
      try {
        if (state.connectionStatus !== 'connected') {
          const response = await fetch('/api/health');
          const data = await response.json();
          
          if (data && data.uptime) {
            uptimeEl.textContent = `${Math.floor(data.uptime)} seconds`;
          }
        }
      } catch (error) {
        console.error('Error updating uptime:', error);
      }
    }, 30000);
  </script>
</body>
</html>
